# Миграция конфигурации OpenShift в базу данных

## Выполненные изменения

### 1. Добавлена поддержка PostgreSQL
- Добавлены зависимости `spring-boot-starter-data-jpa` и `postgresql` в `pom.xml`
- Настроено подключение к PostgreSQL в `application.yml`:
  - URL: `jdbc:postgresql://localhost:5432/openshift_controller`
  - Пользователь: `postgres`
  - Пароль: `q1w2e3r4`
  - Hibernate настроен на автоматическое создание/обновление таблиц (`ddl-auto: update`)

### 2. Создана структура для хранения конфигурации в БД
- **Entity**: `OpenShiftConnection` - хранит параметры подключения (URL, токен, namespace, название)
- **Repository**: `OpenShiftConnectionRepository` - для работы с БД
- **Service**: `ConnectionService` - бизнес-логика управления конфигурациями
- **Service**: `OpenShiftClientService` - динамическое создание OpenShift клиента на основе данных из БД

### 3. Обновлены существующие сервисы
- `PodService` - теперь использует `OpenShiftClientService` вместо прямого инжекта `OpenShiftClient`
- `DeploymentService` - обновлен для использования `OpenShiftClientService`
- `NamespaceService` - обновлен для использования `OpenShiftClientService` и получения namespace из БД

### 4. Создан веб-интерфейс для настройки подключения
- **Контроллер**: `ConnectionController` - обработка запросов на настройку подключения
- **Шаблон**: `connection-setup.html` - форма для ввода параметров подключения
- Главная страница (`/`) теперь проверяет наличие подключения и перенаправляет на форму настройки, если подключение не настроено

### 5. Удалена конфигурация из application.yml
- Убраны параметры `openshift.master-url`, `openshift.namespace`, `openshift.token` из `application.yml`
- `OpenShiftConfig` больше не создает клиент при старте приложения

## Настройка базы данных

Перед первым запуском приложения необходимо создать базу данных:

```sql
CREATE DATABASE openshift_controller;
```

Или выполните скрипт `create-database.sql`.

Таблицы будут созданы автоматически при первом запуске приложения благодаря настройке `spring.jpa.hibernate.ddl-auto=update`.

## Использование

1. Запустите PostgreSQL на порту 5432
2. Создайте базу данных `openshift_controller`
3. Запустите приложение
4. При первом открытии главной страницы (`http://localhost:8080`) вы будете перенаправлены на страницу настройки подключения
5. Заполните форму:
   - URL кластера OpenShift
   - Токен аутентификации
   - Namespace по умолчанию (необязательно)
   - Название подключения (необязательно)
6. После сохранения подключение будет активно и можно работать с OpenShift

## Управление несколькими подключениями

Теперь можно добавлять и управлять несколькими подключениями к разным OpenShift кластерам:

1. **Добавление нового подключения:**
   - Перейдите на страницу `/connection/setup`
   - Заполните форму с параметрами нового подключения
   - Если уже есть активное подключение, вы можете выбрать, сделать ли новое подключение активным
   - Если активных подключений нет, новое подключение автоматически станет активным

2. **Активация подключения:**
   - В списке подключений нажмите кнопку "Активировать" для нужного подключения
   - Текущее активное подключение будет автоматически деактивировано

3. **Редактирование подключения:**
   - Нажмите кнопку "Редактировать" для нужного подключения
   - Измените параметры и сохраните

4. **Удаление подключения:**
   - Нажмите кнопку "Удалить" для нужного подключения
   - Подтвердите удаление

**Важно:** В любой момент времени может быть активно только одно подключение. При активации нового подключения предыдущее автоматически деактивируется.

